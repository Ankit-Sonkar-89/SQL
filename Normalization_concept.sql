CREATE DATABASE NORMALISATION ;
USE NORMALISATION ;

CREATE TABLE STUDENTS_UNNORMALISED (
STUDENT_ID INT ,
STUDENT_NAME VARCHAR(50) ,
SUBJECTS VARCHAR(100) ,
TEACHER VARCHAR(100) 
);

INSERT INTO STUDENTS_UNNORMALISED VALUES
(1,"AFTAB","DBMS , OS ","DR.SHARAMA"),
(2,"ANKIT","DBMS , CG " ,"DR.SHARAMA");

# MULTIPLE VALUES IN ONE COLOUMN
# DIFFICULT TO SEARCH 
# REBUNDANT TEACHER INFO

# CONVERT TO 1NF

CREATE TABLE STUDENTS_1NF (
STUDENT_ID INT , 
STUDENT_NAME VARCHAR(50),
SUBJECT VARCHAR(50)
);

INSERT INTO STUDENTS_1NF VALUES
(1,"AFTAB","DBMS"),
(1,"AFTAB","OS"),
(2,"ANKIT","DBMS"),
(2,"ANKIT","CG");

# NOW EACH CELL HAS ONE VALUE 

# CONVERT TO 2NF
# 2NF REMOVES PARTIAL DEPENDENCY
# PRIMARY KEY IN STUDENTS_1NF COULD BE :
# ( STUDENT_ID , SUBJECT )
# BUT STUDENT_NAME DEPENDS ONLY ON STUDENT_ID , NOT ON SUBJECT ---> PARTIAL DEPENDENCY *** NOT
# SO SPLIT TABLES :

# STUDENT TABLE
CREATE TABLE STUDENTS (
STUDENT_ID INT PRIMARY KEY ,
STUDENT_NAME VARCHAR(50)
);
# SUBJECT TABLE ( RELATIONSHIP TABLE )
CREATE TABLE STUDENT_SUBJECTS (
STUDENT_ID INT ,
SUBJECT VARCHAR(50) ,
PRIMARY KEY ( STUDENT_ID , SUBJECT ) ,
FOREIGN KEY ( STUDENT_ID ) REFERENCES STUDENTS ( STUDENT_ID )
);
INSERT INTO STUDENTS VALUE 
(1,"AFTAB"),
(2,"ANKIT");

INSERT INTO STUDENT_SUBJECTS VALUES
(1,"DBMS"),
(1,"OS"),
(2,"DBMS"),
(2,"CG");
 
 # NO DUPLICATE UPDATES 
 # EASIER UPDATES
 # LESS STORAGE
 
 # 3NF REMOVES TRANSITIVE DEPENDENCY 
 # SUPPOSE WE ADD TEACHER :
 
 CREATE TABLE STUDENTS_SUBJECTS_2 (
 STUDENT_ID INT ,
 SUBJECT VARCHAR(50),
 TEACHER VARCHAR(50)
 );
# BUT TEACHER DEPENDS ON SUBJECT , NOT STUDENT ----> TRANSITIVE DEPENDENCY ***
# SO SPLIT AGAIN :
# SUBJECT TABLE 
CREATE TABLE SUBJECTS (
SUBJECT VARCHAR(50) PRIMARY KEY ,
TEACHER VARCHAR(50)
);
# STUDENT-SUBJECT LINK TABLE 
CREATE TABLE STUDENT_SUBJECT_MAP (
STUDENT_ID INT ,
SUBJECT VARCHAR(50) ,
PRIMARY KEY ( STUDENT_ID , SUBJECT ) ,
FOREIGN KEY ( STUDENT_ID ) REFERENCES STUDENTS ( STUDENT_ID ),
FOREIGN KEY ( SUBJECT ) REFERENCES SUBJECTS ( SUBJECT )
);
INSERT INTO SUBJECTS VALUES 
("DBMS" , "DR.SHARMA" ),
("OS" ,"DR.MEHTA"),
("CG","DR.GUPTA");
INSERT INTO STUDENT_SUBJECT_MAP VALUES
(1,"DBMS"),
(1,"OS"),
(2,"DBMS"),
(2,"CG");

# NO REBUNDANCY
# NO ANOMALIES
# DATA IS CLEAN

# SHOW STUDENT WITH SUBJECTS 

SELECT S.STUDENT_NAME , M.SUBJECT
FROM STUDENT S
JOIN STUDENT_SUBJECT_MAP M
ON S.STUDENT_ID = M.STUDENT_ID ; 

# SHOW SUBJECT TEACHERS 

SELECT SUBJECT , TEACHER 
FROM SUBJECTS ;

# SHOW STUDENTC + SUBJECT  + TEACHER 

SELECT S.STUDENT_NAME , M.SUBJECT , SUB.TEACHER 
FROM STUDENTS S
JOIN STUDENT_SUBJECT_MAP M ON S.STUDENT_ID = M.STUDENT_ID
JOIN SUBJECTS SUB ON M.SUBJECT = SUB.SUBJECT ;
